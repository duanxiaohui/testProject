(function() {    var rRoute, rFormat;    $.route = function(obj, path) {        obj = obj || {};        var m;        (rRoute || (rRoute = /([\d\w_]+)/g)).lastIndex = 0;        while ((m = rRoute.exec(path)) !== null) {            obj = obj[m[0]];            if (obj == undefined) {                break            }        }        return obj    };    $.format = function() {        var args = $.makeArray(arguments),            str = String(args.shift() || ""),            ar = [],            first = args[0];        args = $.isArray(first) ? first : typeof(first) == 'object' ? args : [args];        $.each(args, function(i, o) {            ar.push(str.replace(rFormat || (rFormat = /\{([\d\w\.]+)\}/g), function(m, n, v) {                v = n === 'INDEX' ? i : n.indexOf(".") < 0 ? o[n] : $.route(o, n);                return v === undefined ? m : ($.isFunction(v) ? v.call(o, n) : v)            }));        });        return ar.join('');    };    var rPad;    $.padWithZero = function(str) {        return str.replace((rPad || (rPad = /(^|\D)(\d)(?=$|\D)/g)), '$10$2');    };})();/** * 放假安排数据 * @return {null} * { * 	2013: { * 		festival : {}, * 		workday: {} * 	}, * 	2014: { * 		festival : {}, * 		workday: {} * 	} * } */var holidayDate = festivalInfo;var festivalAndWorkDay = worktime;var instance = {    getNameByDay: function(date){        var dateString = '/' + (date.getMonth() + 1) + '/' + date.getDate();        console.log(dateString);        for(var i = 0, l = holidayDate.length; i < l; i++){            if(holidayDate[i].from === dateString){                return holidayDate[i].name            }        }        return '';    }};function Calendar(date) {    this.date = date ? new Date(+date) : (G.currDate || new Date);}Calendar.prototype = {    getMonthFirstDate: function() {        var date = new Date(+this.date);        date.setDate(1);        return date;    },    getCalendarFirstDate: function(isSundayFirst) {        var date = this.getMonthFirstDate(),            day = date.getDay();        date.setDate(date.getDate() - (isSundayFirst ? day : day == 0 ? 6 : (day - 1)));        return date;    }};$.widget('meixx.webCalendar', {    options: {        defDate: new Date(),        onselect: $.noop    },    _create: function() {        var self = this,            $elem = $(this.element),            opt = this.options;        var now = this.today = opt.defDate,            year = now.getFullYear(),            month = now.getMonth() + 1;        this.panel = $elem.find('ul.js-cld-panel');        this.tmplDate = '<li class="{monthClass}" date="{date}"><div class="grid"><div class="vacation_icon"></div><div class="solar_data">{solar}</div><div class="lunar_data">{lunar}</div></div></li>';        this.initCalendar(year, month);        // this.initPrevCalendar(year, month - 1);        // this.initNextCalendar(year, month + 1);        // this.setPosition();        opt.onselect.call(self, now, lunar(now));        this.handleClick();        this.initDatePicker();        self.selectdate();    },        initCalendar: function(year, month, vocFrom, vocTo, data ,festivalIcon) {        var self = this,            $elem = $(this.element),            opt = this.options;        var d = new Date(year, month - 1, 1),            c = new Calendar(d),            firstDay = c.getCalendarFirstDate(),            t = this.today,            day;        if (vocFrom) {            vocFrom = new Date(vocFrom);            vocTo = new Date(vocTo);            if (vocFrom < firstDay) {                firstDay = new Date(vocFrom);                day = firstDay.getDay()                firstDay.setDate(firstDay.getDate() - (day == 0 ? 6 : (day - 1)));            }        }        this.year = d.getFullYear();        this.month = d.getMonth() + 1;        $('#sp_year').html(this.year);        $('#sp_month').html(this.month);        $("#sp_year_select option[value='"+this.year+"']").attr("selected", "selected");        $("#sp_month_select option[value='"+this.month+"']").attr("selected", "selected");        var iterator = new Date(firstDay),            rowsHtml = $.map(new Array(42), function(_, i) {                var y = iterator.getFullYear(),                    m = iterator.getMonth(),                    d = iterator.getDate(),                    w = iterator.getDay(),                    l = lunar(iterator);                var selector = [],                    key = 'm' + (m + 1) + 'd' + d,                    festival = l.festival(),                    isVoc = false;                if(                	(function () {	                	for(var i in festivalAndWorkDay){	                		if(y == i){	                			return true	                		}	                	}	                	return false	                })()	            ){                	if (vocFrom) {	                    if (+iterator >= +vocFrom && +iterator <= +vocTo) {	                        festivalAndWorkDay[y]['festival'][key] && (isVoc = true) && selector.push(festivalAndWorkDay[y]['festival'][key], 'vacation');	                        festivalAndWorkDay[y]['workday'][key] && (isVoc = true) && selector.push(festivalAndWorkDay[y]['workday'][key]);	                    }	                    if (!isVoc) {	                        selector.push('befor');	                    }	                } else {	                    festivalAndWorkDay[y]['festival'][key] && selector.push(festivalAndWorkDay[y]['festival'][key], 'vacation');	                    festivalAndWorkDay[y]['workday'][key] && selector.push(festivalAndWorkDay[y]['workday'][key]);	                    data == d && m == month - 1 && selector.push('on');	                    m != month - 1 && selector.push('befor');	                    d == t.getDate() && m == t.getMonth() && y == t.getFullYear() && selector.push('today on');	                    (w == 0 || w == 6) && selector.push('weekend');	                    l.term ? selector.push('solar') : festival.length ? selector.push('isolar') : '';	                }                }				else {                    data == d && m == month - 1 && selector.push('on');                    m != month - 1 && selector.push('befor');                    d == t.getDate() && m == t.getMonth() && y == t.getFullYear() && selector.push('today on');                    (w == 0 || w == 6) && selector.push('weekend');                    l.term ? selector.push('solar') : festival.length ? selector.push('isolar') : '';                }                iterator.setDate(iterator.getDate() + 1);                return $.format(self.tmplDate, {                    monthClass: selector.join(' '),                    solar: d,                    lunar: festival[0] && festival[0].desc.length < 7 && festival[0].desc || l.term || l.dateIndex == 0 && (l.lMonth + '月' + (l.isBigMonth ? '大' : '小')) || l.lDate,                    date: [y, m + 1, d].join('/')                });            });        this.panel.css('opacity', 0.2).html(rowsHtml).fadeTo(200, 1).attr({            'data-year': d.getFullYear(),            'data-month': d.getMonth() + 1        });        data && self.festivalClick(this.panel.find("li.on"));        self.calculate();        festivalIcon||self.screenGrid($('.js-cld-panel'));    },    reloadPanel: function() {        this.panel = $('ul.js-cld-panel');    },    initPrevCalendar: function(year, month, vocFrom, vocTo, data) {        var self = this,            $elem = $(this.element),            opt = this.options;        var d = new Date(year, month - 1, 1),            c = new Calendar(d),            firstDay = c.getCalendarFirstDate(),            t = this.today,            day;        if (vocFrom) {            vocFrom = new Date(vocFrom);            vocTo = new Date(vocTo);            if (vocFrom < firstDay) {                firstDay = new Date(vocFrom);                day = firstDay.getDay()                firstDay.setDate(firstDay.getDate() - (day == 0 ? 6 : (day - 1)));            }        }        var iterator = new Date(firstDay),            rowsHtml = $.map(new Array(42), function(_, i) {                var y = iterator.getFullYear(),                    m = iterator.getMonth(),                    d = iterator.getDate(),                    w = iterator.getDay(),                    l = lunar(iterator);                var selector = [],                    key = 'm' + (m + 1) + 'd' + d,                    festival = l.festival(),                    isVoc = false;                if(                	(function () {	                	for(var i in festivalAndWorkDay){	                		if(y == i){	                			return true	                		}	                	}	                	return false	                })()	            ){                	if (vocFrom) {	                    if (+iterator >= +vocFrom && +iterator <= +vocTo) {	                        festivalAndWorkDay[y]['festival'][key] && (isVoc = true) && selector.push(festivalAndWorkDay[y]['festival'][key], 'vacation');	                        festivalAndWorkDay[y]['workday'][key] && (isVoc = true) && selector.push(festivalAndWorkDay[y]['workday'][key]);	                    }	                    if (!isVoc) {	                        selector.push('befor');	                    }	                } else {	                    festivalAndWorkDay[y]['festival'][key] && selector.push(festivalAndWorkDay[y]['festival'][key], 'vacation');	                    festivalAndWorkDay[y]['workday'][key] && selector.push(festivalAndWorkDay[y]['workday'][key]);	                    data == d && m == month - 1 && selector.push('on');	                    m != month - 1 && selector.push('befor');	                    d == t.getDate() && m == t.getMonth() && y == t.getFullYear() && selector.push('today on');	                    (w == 0 || w == 6) && selector.push('weekend');	                    l.term ? selector.push('solar') : festival.length ? selector.push('isolar') : '';	                }                }				else {                    data == d && m == month - 1 && selector.push('on');                    m != month - 1 && selector.push('befor');                    d == t.getDate() && m == t.getMonth() && y == t.getFullYear() && selector.push('today on');                    (w == 0 || w == 6) && selector.push('weekend');                    l.term ? selector.push('solar') : festival.length ? selector.push('isolar') : '';                }                iterator.setDate(iterator.getDate() + 1);                return $.format(self.tmplDate, {                    monthClass: selector.join(' '),                    solar: d,                    lunar: festival[0] && festival[0].desc.length < 7 && festival[0].desc || l.term || l.dateIndex == 0 && (l.lMonth + '月' + (l.isBigMonth ? '大' : '小')) || l.lDate,                    date: [y, m + 1, d].join('/')                });            });        $('.js-cld-panel_prev').css('opacity', 0.2).html(rowsHtml).fadeTo(200, 1).attr({            'data-year': d.getFullYear(),            'data-month': d.getMonth() + 1        });        // data && self.festivalClick($('.js-cld-panel_prev').find('li.on'));        self.calculate();        self.screenGrid($('.js-cld-panel_prev'));        window.checkPrevInitStatus = true;    },    initNextCalendar: function(year, month, vocFrom, vocTo, data) {        var self = this,            $elem = $(this.element),            opt = this.options;        var d = new Date(year, month - 1, 1),            c = new Calendar(d),            firstDay = c.getCalendarFirstDate(),            t = this.today,            day;        if (vocFrom) {            vocFrom = new Date(vocFrom);            vocTo = new Date(vocTo);            if (vocFrom < firstDay) {                firstDay = new Date(vocFrom);                day = firstDay.getDay()                firstDay.setDate(firstDay.getDate() - (day == 0 ? 6 : (day - 1)));            }        }        // this.year = d.getFullYear();        // this.month = d.getMonth() + 1;        // $('#sp_year').html(this.year);        // $('#sp_month').html(this.month);        // $("#sp_year_select option[value='"+this.year+"']").attr("selected", "selected");        // $("#sp_month_select option[value='"+this.month+"']").attr("selected", "selected");        var iterator = new Date(firstDay),            rowsHtml = $.map(new Array(42), function(_, i) {                var y = iterator.getFullYear(),                    m = iterator.getMonth(),                    d = iterator.getDate(),                    w = iterator.getDay(),                    l = lunar(iterator);                var selector = [],                    key = 'm' + (m + 1) + 'd' + d,                    festival = l.festival(),                    isVoc = false;                if(                	(function () {	                	for(var i in festivalAndWorkDay){	                		if(y == i){	                			return true	                		}	                	}	                	return false	                })()	            ){                	if (vocFrom) {	                    if (+iterator >= +vocFrom && +iterator <= +vocTo) {	                        festivalAndWorkDay[y]['festival'][key] && (isVoc = true) && selector.push(festivalAndWorkDay[y]['festival'][key], 'vacation');	                        festivalAndWorkDay[y]['workday'][key] && (isVoc = true) && selector.push(festivalAndWorkDay[y]['workday'][key]);	                    }	                    if (!isVoc) {	                        selector.push('befor');	                    }	                } else {	                    festivalAndWorkDay[y]['festival'][key] && selector.push(festivalAndWorkDay[y]['festival'][key], 'vacation');	                    festivalAndWorkDay[y]['workday'][key] && selector.push(festivalAndWorkDay[y]['workday'][key]);	                    data == d && m == month - 1 && selector.push('on');	                    m != month - 1 && selector.push('befor');	                    d == t.getDate() && m == t.getMonth() && y == t.getFullYear() && selector.push('today on');	                    (w == 0 || w == 6) && selector.push('weekend');	                    l.term ? selector.push('solar') : festival.length ? selector.push('isolar') : '';	                }                }				else {                    data == d && m == month - 1 && selector.push('on');                    m != month - 1 && selector.push('befor');                    d == t.getDate() && m == t.getMonth() && y == t.getFullYear() && selector.push('today on');                    (w == 0 || w == 6) && selector.push('weekend');                    l.term ? selector.push('solar') : festival.length ? selector.push('isolar') : '';                }                iterator.setDate(iterator.getDate() + 1);                return $.format(self.tmplDate, {                    monthClass: selector.join(' '),                    solar: d,                    lunar: festival[0] && festival[0].desc.length < 7 && festival[0].desc || l.term || l.dateIndex == 0 && (l.lMonth + '月' + (l.isBigMonth ? '大' : '小')) || l.lDate,                    date: [y, m + 1, d].join('/')                });            });        $('.js-cld-panel_next').css('opacity', 0.2).html(rowsHtml).fadeTo(200, 1).attr({            'data-year': d.getFullYear(),            'data-month': d.getMonth() + 1        });        // data && self.festivalClick($('.js-cld-panel_next').find('li.on'));        self.calculate();        self.screenGrid($('.js-cld-panel_next'));    },    selectdate: function() {        var self = this,            $elem = $(this.element),            opt = this.options;        var d = new Date(),            y = d.getFullYear(),            m = d.getMonth() + 1;        var yearHtml = " ";        for (var i = 1979; i < 2051; i++) {            yearHtml += '<option value="' + i + '">' + i + '</option>';        }        $("#sp_year_select").html(yearHtml);        var CaYear = $("#sp_year").html();        $("#sp_year_select option[value='"+CaYear+"']").attr("selected", "selected");                $("#sp_year_select").change(function() {            var yearVal = +$(this).children('option:selected').val();            var mVal = $("#sp_month_select").children('option:selected').val();            //上一年            var Pdate = new Date(yearVal, mVal - 2);            var Pyear = Pdate.getFullYear();            var Pmonth = Pdate.getMonth() + 1;            //当前年            var date = new Date(yearVal, mVal - 1);            var year = date.getFullYear();            var month = date.getMonth() + 1;            //下一年            var Ndate = new Date(yearVal, mVal);            var Nyear = Ndate.getFullYear();            var Nmonth = Ndate.getMonth() + 1;            // self.initPrevCalendar(Pyear, Pmonth);            self.initCalendar(year, month);            // self.initNextCalendar(Nyear, Nmonth);        });        var monthHtml = " ";        for (var i = 1; i < 13; i++) {            monthHtml += '<option value="' + i + '">' + i + '</option>';        }        $("#sp_month_select").html(monthHtml);        var CaMonth = $("#sp_month").html();        $("#sp_month_select option[value='"+CaMonth+"']").attr("selected", "selected");        $("#sp_month_select").change(function() {            var yearVal = $("#sp_year_select").children('option:selected').val();            var mVal = +$(this).children('option:selected').val();            //上一年            var Pdate = new Date(yearVal, mVal - 2);            var Pyear = Pdate.getFullYear();            var Pmonth = Pdate.getMonth() + 1;            //当前年            var date = new Date(yearVal, mVal - 1);            var year = date.getFullYear();            var month = date.getMonth() + 1;            //下一年            var Ndate = new Date(yearVal, mVal);            var Nyear = Ndate.getFullYear();            var Nmonth = Ndate.getMonth() + 1;            // self.initPrevCalendar(Pyear, Pmonth);            self.initCalendar(year, month);            // self.initNextCalendar(Nyear, Nmonth);        });    },    screenGrid: function(eul) {        var self = this,            $elem = $(this.element),            opt = this.options;        var $grid= $(".calendar_grid");        var $firstLi = eul.find("li:not(.befor):first");        var $lasttLi = eul.find("li:not(.befor):last");        var firstIndex = $firstLi.index();        var lastIndex = $lasttLi.index();        var num = firstIndex - 1;        var numt = lastIndex - 1;        var s = eul.find("li:lt(" + num + ")");        var t = eul.find("li:gt(" + numt + ")");        var rowNum;        if (firstIndex >= 7) {            s.hide();        }        if ((41 - lastIndex) >= 7) {            eul.find("li:gt(34)").hide();        }        var $li = eul.find("li:visible");        rowNum = $li.size()/7;        if(rowNum == 5){        	if($grid.height() < 355){        		eul.addClass("five");        	}else {        		eul.addClass("fives");        	}        	        }else if(rowNum == 4){        	if($grid.height() < 355){        		eul.addClass("four");        	}else {        		eul.addClass("fours");        	}        }else{            eul.removeClass("five");            eul.removeClass("fives");            eul.removeClass("four");            eul.removeClass("fours");        }    },    setCalendarDate: function(date) {        var self = this,            $elem = $(this.element),            opt = this.options;        var year = date.getFullYear();        var month = date.getMonth() + 1;        var date = date.getDate();        $('#sp_year').html(year);        $('#sp_month').html(month);        self.initCalendar(year, month, undefined, undefined, date);    },    handleClick: function() {        var self = this,            $elem = $(this.element),            opt = this.options;        $('li', self.panel).live('click', function() {            self.panel.find('li.on').removeClass('on');            self.panel.find('li.reston').removeClass('reston').addClass('rest');            self.panel.find('li.workon').removeClass('workon').addClass('work');            $('li', self.panel).removeClass('on liactive');            var $li = $(this).addClass('on liactive'),                strDate = $li.attr('date'),                d = new Date(strDate),                year = d.getFullYear(),                month = d.getMonth() + 1;            var sp_month = $elem.find("#sp_month").text();            if (month != sp_month) {                // self.initPrevCalendar(year,month - 1);                self.initCalendar(year, month);                // self.initNextCalendar(year,month + 1);                self.panel.find('li[date="' + strDate + '"]').addClass('on');                self.panel.find('li[date="' + strDate + '"]').click();            } else {                opt.onselect.call(self, d, lunar(d));            }            //zoom();        });    },    festivalClick: function($li) {        var self = this,            $elem = $(this.element),            opt = this.options;        var strDate = $li.attr('date'),            d = new Date(strDate);        opt.onselect.call(self, d, lunar(d));    },    initDatePicker: function() {        var self = this,            $elem = $(this.element),            opt = this.options;        $elem.find('a.today_btn').click(function(evt) {            evt.preventDefault();            var y =+self.today.getFullYear(), m = +self.today.getMonth();            // self.initPrevCalendar(y, m);            self.initCalendar(y,m + 1);            // self.initNextCalendar(y, m + 2);            self.panel.find('li.today').click();        });        // 切换上下月        $elem.find('div.select a.prev_btn,div.select a.next_btn').click(function(evt) {            evt.preventDefault();            var $lnk = $(this),                SpMonth = parseInt($('#sp_month').html()) ,                SpYear = parseInt($('#sp_year').html()),                delta = parseInt($lnk.attr('delta') - 0);                //当前月                var swdate = new Date(SpYear, SpMonth + delta),                    swYear = swdate.getFullYear();                    swMonth = swdate.getMonth() ;                //上一月                // var spdate = new Date(SpYear, SpMonth + delta - 1),                //     spdYear = spdate.getFullYear();                //     spdMonth = spdate.getMonth();                //下一月                // var sndate = new Date(SpYear, SpMonth + delta + 1),                //     snYear = sndate.getFullYear();                //     snMonth = sndate.getMonth();                // self.initPrevCalendar(spdYear , spdMonth)                              self.initCalendar(swYear, swMonth);                // self.initNextCalendar(snYear , snMonth)        });    },     getYear: function() {        return this.year;    },    getMonth: function() {        return this.month;    },    getPanel: function() {        return this.panel;    },    calculate: function() {        var $h = $(window).height();        var $calendar_grid = $(".calendar_grid");        var $grid_li = $(".calendar_grid_list").find("li");        var $grid = $(".grid");        var $solar_data = $(".solar_data");        var $lunar_data = $(".lunar_data")        var grid_li_w = $grid_li.width();        var posh = $(".calendar_position");        if ($h > 557) {            var solar_view_h = $h - posh.height();            $(".solar_view").height(solar_view_h);            $(".today .grid").width("51px").height("51px");            posh.css({                "position": "absolute"            });            $calendar_grid.height(355);            if (grid_li_w < 54) {                 $calendar_grid.height(301);            }else if(grid_li_w>54){                $grid.width(54);                $grid.height(54);            }        } else {            $calendar_grid.height(301);            posh.css({                "position": "static"            });        }        //宽度小于54的表示屏幕宽度为320        if (grid_li_w < 54) {            //设置日历格子高度和宽度一致            $grid_li.height(grid_li_w);            $grid.height(grid_li_w - 2).width(grid_li_w - 2);            var grid_h = $grid_li.height();            $calendar_grid.height(grid_h*6 + 25);            var sldata_h = (grid_li_w - 4) / 2;            $lunar_data.css({                "height": sldata_h,                "line-height": sldata_h - 8 + "px"            });            $solar_data.css({                "height": sldata_h,                "line-height": sldata_h + "px",                "font-size": "18px",                "padding-top": "5px"            });        }    }});$.widget('meixx.dayDetail', {    options: {},    _create: function() {        var self = this,            $elem = $(this.element),            opt = this.options;        this.tmpl = '<div class="today_solar e_clear">\	    		<div class="today_solar_txt">\	    			{month}月{date}日\	    		</div>\	    		<div class="today_lunar_txt">\	    			<p class="today_lunar">{lmonth}月{ldate}</p>\	    			<p class="today_week_txt">{week}</p>\	    		</div>\	    	</div>\	    	<div class="holiday_txt">\	    		{term}\	    	</div>\	    	<div class="hl">\	    		<div class="yi"></div>\	    		<div class="ji"></div>\	    	</div>';    },    init: function(date, l) {        var self = this,            $elem = $(this.element),            opt = this.options;        var y = date.getFullYear(),            m = date.getMonth() + 1,            d = date.getDate(),            now = new Date();        $elem.html($.format(this.tmpl, {            year: y,            month: m,            term: function() {                var s = [];                var o = l.festival();                for (var i = 0; i < o.length; i++) {                    s.push('<div class="holiday_icon">' + o[i].desc + '</div>');                };                l.term && s.push('<div class="holiday_icon">' + l.term + '</div>');                return s.join('');            },            padmonth: ('0' + m).slice(-2),            paddate: ('0' + d).slice(-2),            date: d,            week: '星期' + l.cnDay,            animal: l.animal,            istoday: now.getDate() == d && now.getMonth() == date.getMonth() && now.getFullYear() == y ? '<div class="today_icon"></div>' : '',            lmonth: l.lMonth,            ldate: l.lDate,            gzyear: l.gzYear,            gzmonth: l.gzMonth,            gzdate: l.gzDate        }));        this.loadLuckyData(y, m, d);    },    loadLuckyData: function(y, m, d) {        var self = this,            $elem = $(this.element),            opt = this.options;        var strDate = 'd' + ('0' + m).slice(-2) + ('0' + d).slice(-2);        if (window.HuangLi && HuangLi['y' + y]) {            this.fillLuckyData(HuangLi['y' + y][strDate]);        } else if (y > 2007 && y < 2021) {            $.getScript('http://baidu365.duapp.com/wannianlibaidu/js/huangli/hl' + y + '.js', function() {                self.fillLuckyData(HuangLi['y' + y][strDate]);            });        } else {            this.fillLuckyData({                'y': '',                'j': ''            });        }    },    fillLuckyData: function(data) {        var self = this,            $elem = $(this.element),            opt = this.options;        var y = data.y.replace(/^\.|\.$/g, '').split('.'),            j = data.j.replace(/^\.|\.$/g, '').split('.');        if(y==""||j==""){            $elem.find("div.hl").hide();        }        $elem.find('div.yi').html(dealString(y)).attr('title', y.join(' '));        $elem.find('div.ji').html(dealString(j)).attr('title', j.join(' '));    }});function dealString(ar) {    ar = ar.sort(function(a, b) {        return a.length - b.length;    });    var arRslt = [],        t;    $.each(ar, function(i, s) {        arRslt.push(s);    });    return arRslt.slice(0, 5).join('.');}$.widget('zmc.vacationLayer', {    options: {},    _create: function() {        var self = this,            $elem = $(this.element),            opt = this.options;        $elem.append(opt.tmplHead + $.format(opt.tmplBody, opt.data) + opt.tmplTail);        $elem.click(function(evt) {            evt.preventDefault();            evt.stopPropagation();            var $tip = $('div.vac_solar_layer', this),                isVisible = $tip.is(':visible');            $('#div_buttons div.vac_solar_layer').not($tip).hide().parent().removeClass('on');            $tip[isVisible ? 'hide' : 'show']('fade').parent()[isVisible ? 'removeClass' : 'addClass']('on');            if(opt.type == 'v'){                 $elem.find('ul').append('<li></li>');            }            var $w = $(window).width();            $('.vac_solar_layer').width($w - 6);            var vw = $w - 66;            var sw = $w - 30;            $('.vac_layer').css({                "margin-left": -vw + 'px'            });            $('.solar_layer').css({                "margin-left": -sw + 'px'            });        });        $elem.find('li').click(function(evt) {            evt.stopPropagation();            var $li = $(this),                year = opt.type == 'v' ? new Date().getFullYear() : ($('#bd').webCalendar('getYear') - ($('#bd').webCalendar('getMonth') == 1 ? 1 : 0)),                idx = $li.attr('idx') - 0;            var month = opt.type == 'v' ? $li.attr('month') - 0 : Math.ceil((idx + 1) / 2) + 1;            var date = new Date(year, month - 1);            year = date.getFullYear();            month = date.getMonth() + 1;            $elem.find('div.vac_solar_layer').hide();            $elem.removeClass("on");            if (opt.type == 's') {                 //上一年                var sPdate = new Date(year, month - 2);                var sPyear = sPdate.getFullYear();                var sPmonth = sPdate.getMonth() + 1;                 //下一年                var sNdate = new Date(year, month);                var sNyear = sNdate.getFullYear();                var sNmonth = sNdate.getMonth() + 1;                // $('#bd').webCalendar('initPrevCalendar',sPyear, sPmonth,undefined,undefined,undefined,true);                $('#bd').webCalendar('initCalendar', year, month);                // $('#bd').webCalendar('initNextCalendar', sNyear, sNmonth);                $('#bd').webCalendar('getPanel').find('li:not(.befor).solar:' + (idx % 2 ? 'last' : 'first')).addClass('on').click();            } else if (opt.type == 'v') {                if($li.index() > 6){                    return false;                }                if($li.attr('month') == '{month}'){                    return false;                }                $('#bd').webCalendar('initCalendar', year, month, new Date().getFullYear() + $li.attr('from'), new Date().getFullYear() + $li.attr('to'),undefined,true);                                // $('#bd').webCalendar('initNextCalendar',year, month+1);                //上一年                var Pdate = new Date(year, month - 2);                var Pyear = Pdate.getFullYear();                var Pmonth = Pdate.getMonth() + 1;                // $('#bd').webCalendar('initPrevCalendar',Pyear, Pmonth);                 // $(".vacation_exp").html($li.attr('exp'));            }        });        $("body").click(function(evt) {            evt.stopPropagation();            var $tip = $('div.vac_solar_layer', this),                isVisible = $tip.is(':visible');            $(".vacation_exp").text('');            if (isVisible) {                $tip.hide('fade');                $("#div_buttons a").removeClass("on");            }        });        if (opt.bdParam.slice(0, 4) != 'rili') {            if (opt.bdParam == "jieqi") {                opt.type == 's' && $elem.click();            }            if (opt.bdParam == "jiaqi") {                opt.type == 'v' && $elem.click();            }            var reg = /^([1-2]\d{3})[\/|\-](0?[1-9]|10|11|12)[\/|\-]([1-2]?[0-9]|0[1-9]|30|31)$/;            ac = reg.test(opt.bdParam);            if (ac) {                var dateArry = opt.bdParam.split("-");                var year = dateArry[0],                    month = parseInt(dateArry[1], 10),                    date = parseInt(dateArry[2], 10);                var d = new Date();                d.setFullYear(year);                d.setMonth(month - 1);                d.setDate(date);                $('#bd').webCalendar("setCalendarDate", d);            } else {                $elem.find('div.vac_solar_layer li[pinyin="' + opt.bdParam + '"]').click();            }        }    }});(function() {    var queryJson, str;    $.query = function(name) {        if (!queryJson) {            queryJson = {};            if (str = location.search.slice(1) + '&' + location.hash.slice(1)) {                $.each(str.split('&'), function(i, s, key, value) {                    s = s.split('='), key = s[0], value = s[1];                    if (key in queryJson) {                        if ($.isArray(queryJson[key])) {                            queryJson[key].push(value);                        } else {                            queryJson[key] = [queryJson[key], value];                        }                    } else {                        queryJson[key] = value;                    }                });            }        }        return queryJson[name];    };})();$(function() {    var $detail = $('#div_day_detail'),        bdParam = ($.query('bd_param') || '').toLowerCase();    $detail.dayDetail();    $('#bd').webCalendar({        defDate: bdParam.slice(0, 4) == 'rili' && bdParam.indexOf("_") > -1 ? new Date(bdParam.split('_')[1], 0, 1) : void(0),        onselect: function(d, l) {            $detail.dayDetail('init', d, l);        }    });    /*        footer点击事件     */    var sUserAgent = navigator.userAgent.toLowerCase();    var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";     var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";    var bIsAndroid = sUserAgent.match(/android/i) == "android";    $(".footer").on('click',function(){        if(bIsIphoneOs || bIsIpad){            window.location="https://itunes.apple.com/app/apple-store/id642101382?pt=386041&ct=%E5%A4%A9%E6%B0%94%E9%80%9A&mt=8"        }else{            window.location="http://tqt.weibo.cn/r.php?i=303860885"        }    });    $('#div_buttons a.operate_vacation').vacationLayer({        type: 'v',        bdParam: bdParam,        tmplHead: '<div class="vac_solar_layer vac_layer none"><div class="arror_top"></div><h3>2016年公休放假安排</h3><ul class="e_clear">',        tmplTail: '</ul></div>',        tmplBody: '<li month="{month}" from="{from}" to="{to}" exp="{exp}" pinyin="{py}"><p class="name">{name}</p><p class="time">{time}</p></li>',        data: holidayDate    });    $("#div_buttons a.solar_terms").vacationLayer({        type: 's',        bdParam: bdParam,        tmplHead: '<div class="vac_solar_layer solar_layer none"><div class="arror_top"></div><h3>中国农历·二十四节气</h3><ul class="e_clear">',        tmplTail: '</ul></div>',        tmplBody: '<li idx="{INDEX}" pinyin="{py}"><p>{name}</p></li>',        data: [{            name: '立春',            py: 'lichun'        }, {            name: '雨水',            py: 'yushui'        }, {            name: '惊蛰',            py: 'jingzhe'        }, {            name: '春分',            py: 'chunfen'        }, {            name: '清明',            py: 'qingming'        }, {            name: '谷雨',            py: 'guyu'        }, {            name: '立夏',            py: 'lixia'        }, {            name: '小满',            py: 'xiaoman'        }, {            name: '芒种',            py: 'mangzhong'        }, {            name: '夏至',            py: 'xiazhi'        }, {            name: '小暑',            py: 'xiaoshu'        }, {            name: '大暑',            py: 'dashu'        }, {            name: '立秋',            py: 'liqiu'        }, {            name: '处暑',            py: 'chushu'        }, {            name: '白露',            py: 'bailu'        }, {            name: '秋分',            py: 'qiufen'        }, {            name: '寒露',            py: 'hanlu'        }, {            name: '霜降',            py: 'shuangjiang'        }, {            name: '立冬',            py: 'lidong'        }, {            name: '小雪',            py: 'xiaoxue'        }, {            name: '大雪',            py: 'daxue'        }, {            name: '冬至',            py: 'dongzhi'        }, {            name: '小寒',            py: 'xiaohan'        }, {            name: '大寒',            py: 'dahan'        }]    });});